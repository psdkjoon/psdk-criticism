<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSDK'S Criticism Website</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;600&family=Vazirmatn:wght@400;600;700&display=swap");
      :root {
        --ctp-rosewater: #f5e0dc;
        --ctp-flamingo: #f2cdcd;
        --ctp-pink: #f5c2e7;
        --ctp-mauve: #cba6f7;
        --ctp-red: #f38ba8;
        --ctp-maroon: #eba0ac;
        --ctp-peach: #fab387;
        --ctp-yellow: #f9e2af;
        --ctp-green: #a6e3a1;
        --ctp-teal: #94e2d5;
        --ctp-sky: #89dceb;
        --ctp-sapphire: #74c7ec;
        --ctp-blue: #89b4fa;
        --ctp-lavender: #b4befe;
        --ctp-text: #cdd6f4;
        --ctp-subtext1: #bac2de;
        --ctp-surface0: #313244;
        --ctp-surface1: #45475a;
        --ctp-base: #1e1e2e;
        --ctp-crust: #11111b;
        --accent: var(--ctp-mauve);
        --primary: var(--ctp-pink);
      }
      body {
        background-color: var(--ctp-surface0);
        color: var(--ctp-text);
        font-family: "EB Garamond", "Vazirmatn", sans-serif;
        overflow-x: hidden;
        margin: 0;
        padding: 0;
      }
      body.rtl {
        font-family: "Vazirmatn", "EB Garamond", sans-serif;
      }
      #canvas-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.4;
      }
      .title-font {
        font-family: "EB Garamond", "Vazirmatn";
      }
      .rtl .title-font {
        font-family: "Vazirmatn", "EB Garamond";
      }
      .glass-panel {
        background: rgba(30, 30, 46, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      }
      .input-field {
        background-color: var(--ctp-surface1);
        color: var(--ctp-text);
        border: 2px solid transparent;
        transition: all 0.3s ease;
      }
      .input-field:focus {
        border-color: var(--accent);
        outline: none;
        box-shadow: 0 0 0 4px rgba(var(--accent-rgb), 0.2);
      }
      .btn-primary {
        font-family: "EB Garamond", "Vazirmatn";
        background-color: var(--accent);
        color: var(--ctp-surface0);
        transition:
          transform 0.2s,
          filter 0.2s;
      }
      .btn-primary:hover {
        filter: brightness(1.1);
        transform: translateY(-2px);
      }
      .btn-primary:active {
        transform: translateY(0);
      }
      .accent-text {
        color: var(--accent);
      }
      #nameFieldContainer {
        transition:
          max-height 0.5s ease,
          opacity 0.5s ease,
          margin 0.5s ease;
      }
      #langToggle {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 50;
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease;
      }
      #langToggle:hover {
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(203, 166, 247, 0.3);
      }
      #langToggle:active {
        transform: scale(0.95);
      }
      .lang-icon {
        font-weight: 700;
        font-size: 14px;
      }
      .toggle-container {
        position: relative;
        width: 36px;
        height: 20px;
      }
      .toggle-checkbox {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--ctp-surface0);
        border: 1px solid var(--ctp-surface1);
        transition: 0.3s;
        border-radius: 20px;
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 1px;
        background: white;
        border-radius: 50%;
        transition: 0.3s;
      }
      .toggle-checkbox:checked + .toggle-slider {
        background-color: var(--accent);
        border-color: var(--accent);
      }
      .toggle-checkbox:checked + .toggle-slider:before {
        transform: translateX(16px);
      }
      .rtl .toggle-slider:before {
        left: auto;
        right: 2px;
      }
      .rtl .toggle-checkbox:checked + .toggle-slider:before {
        transform: translateX(-16px);
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center justify-center relative">
    <canvas id="canvas-bg"></canvas>

    <button
      id="langToggle"
      class="glass-panel rounded-full"
      title="ÿ™ÿ∫€å€åÿ± ÿ≤ÿ®ÿßŸÜ / Change Language"
    >
      <span class="lang-icon accent-text" id="langText">ŸÅÿß</span>
    </button>

    <main
      class="w-full max-w-md p-5 mx-4 rounded-2xl glass-panel relative z-10 fade-in"
    >
      <div class="text-center mb-4">
        <h1 class="title-font text-4xl font-bold tracking-tight">
          <span class="en-title"
            ><span class="accent-text">PSDK'S</span> Criticism Website</span
          >
          <span class="fa-title" style="display: none"
            >ÿ™ÿßÿ±ŸÜŸÖÿß€å ŸÜŸÇÿØ <span class="accent-text">ÿ≠ÿ≥€åŸÜ</span></span
          >
        </h1>
        <p
          class="mt-2 text-sm text-[var(--ctp-subtext1)] opacity-80"
          data-i18n="tagline"
        >
          Speak your mind, I'm listening.
        </p>
      </div>

      <form id="criticismForm" class="space-y-4">
        <div
          class="flex items-center justify-between bg-[var(--ctp-surface1)] p-3 rounded-lg"
        >
          <span
            class="text-sm font-medium text-[var(--ctp-text)] flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 accent-text"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z"
                clip-rule="evenodd"
              />
            </svg>
            <span data-i18n="identifyLabel">Identify Yourself?</span>
          </span>
          <label class="toggle-container">
            <input
              type="checkbox"
              name="is_anonymous"
              id="toggle"
              class="toggle-checkbox"
            />
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div
          id="nameFieldContainer"
          class="overflow-hidden -mx-2 px-2"
          style="max-height: 0px; opacity: 0; margin-top: 0; margin-bottom: 0"
        >
          <label
            for="name"
            class="block text-xs font-bold uppercase tracking-wide mb-1 accent-text"
            data-i18n="nameLabel"
            >Your Name</label
          >
          <input
            type="text"
            id="name"
            data-i18n-placeholder="namePlaceholder"
            placeholder="Nicolas Cage"
            class="input-field w-full px-4 py-3 rounded-lg focus:ring-0"
          />
        </div>

        <div>
          <label
            for="message"
            class="block text-xs font-bold uppercase tracking-wide mb-1 accent-text"
            data-i18n="messageLabel"
            >Criticism / Message</label
          >
          <textarea
            id="message"
            rows="5"
            data-i18n-placeholder="messagePlaceholder"
            placeholder="Type your thoughts here..."
            class="input-field w-full px-4 py-3 rounded-lg resize-none focus:ring-0"
            required
          ></textarea>
        </div>

        <div
          class="cf-turnstile"
          data-sitekey="0x4AAAAAACZTEcdBubKfzoBI"
          data-callback="onTurnstileSuccess"
        ></div>
        <script
          src="https://challenges.cloudflare.com/turnstile/v0/api.js"
          async
          defer
        ></script>

        <button
          type="submit"
          id="submitBtn"
          class="btn-primary w-full py-3 px-4 rounded-lg font-bold shadow-lg flex justify-center items-center gap-2"
        >
          <span data-i18n="submitBtn">Send Feedback</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"
            />
          </svg>
        </button>
        <p id="statusMessage" class="text-center text-sm h-5 font-semibold"></p>
      </form>
    </main>

    <script>
      let turnstileToken = "";
      function onTurnstileSuccess(token) {
        turnstileToken = token;
      }

      const translations = {
        en: {
          tagline: "Speak your mind, I'm listening.",
          identifyLabel: "Identify Yourself?",
          nameLabel: "Your Name",
          namePlaceholder: "Nicolas Cage",
          messageLabel: "Criticism / Message",
          messagePlaceholder: "Type your thoughts here...",
          submitBtn: "Send Feedback",
          sending: "Sending...",
          successMsg: "Sent successfully!",
          errorMsg: "Failed to send. Try again.",
          langBtn: "ŸÅÿß",
        },
        fa: {
          tagline: "Ÿáÿ± ⁄ÜŸá ÿØÿ± ÿØŸÑ ÿØÿßÿ±€å ÿ®⁄ØŸàÿå ⁄ØŸàÿ¥ ŸÖ€å‚ÄåÿØŸáŸÖ.",
          identifyLabel: "ÿÆŸàÿØÿ™ ÿ±ÿß ÿ®ÿ¥ŸÜÿßÿ≥ÿßŸÜ€åÿü",
          nameLabel: "ŸÜÿßŸÖ ÿ™Ÿà",
          namePlaceholder: "ÿ¢Ÿá€åŸÑ ÿ¥ÿß€åÿßŸÜ",
          messageLabel: "ŸÜŸÇÿØ / Ÿæ€åÿßŸÖ",
          messagePlaceholder: "ÿßŸÜÿØ€åÿ¥Ÿá‚ÄåŸáÿß€åÿ™ ÿ±ÿß ÿß€åŸÜÿ¨ÿß ÿ®ŸÜŸà€åÿ≥...",
          submitBtn: "ŸÅÿ±ÿ≥ÿ™ÿßÿØŸÜ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ",
          sending: "ÿØÿ± ÿ≠ÿßŸÑ ŸÅÿ±ÿ≥ÿ™ÿßÿØŸÜ...",
          successMsg: "ÿ®ÿß ⁄©ÿßŸÖ€åÿßÿ®€å ŸÅÿ±ÿ≥ÿ™ÿßÿØŸá ÿ¥ÿØ!",
          errorMsg: "ŸÅÿ±ÿ≥ÿ™ÿßÿØŸÜ ŸÜÿß⁄©ÿßŸÖ ÿ®ŸàÿØ. ÿØŸàÿ®ÿßÿ±Ÿá ÿ®⁄©Ÿàÿ¥.",
          langBtn: "EN",
        },
      };

      let currentLang = localStorage.getItem("preferredLang") || "en";
      function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem("preferredLang", lang);
        const html = document.documentElement;
        const body = document.body;
        if (lang === "fa") {
          html.setAttribute("lang", "fa");
          html.setAttribute("dir", "rtl");
          body.classList.add("rtl");
        } else {
          html.setAttribute("lang", "en");
          html.setAttribute("dir", "ltr");
          body.classList.remove("rtl");
        }
        document.querySelector(".en-title").style.display =
          lang === "en" ? "inline" : "none";
        document.querySelector(".fa-title").style.display =
          lang === "fa" ? "inline" : "none";
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          if (translations[lang][key]) el.textContent = translations[lang][key];
        });
        document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
          const key = el.getAttribute("data-i18n-placeholder");
          if (translations[lang][key]) el.placeholder = translations[lang][key];
        });
        document.getElementById("langText").textContent =
          translations[lang].langBtn;
        document.title =
          lang === "fa" ? "ÿ™ÿßÿ±ŸÜŸÖÿß€å ŸÜŸÇÿØ ÿ≠ÿ≥€åŸÜ" : "PSDK'S Criticism Website";
      }
      setLanguage(currentLang);
      document.getElementById("langToggle").addEventListener("click", () => {
        setLanguage(currentLang === "en" ? "fa" : "en");
      });

      const colors = [
        { name: "rosewater", hex: "#f5e0dc" },
        { name: "flamingo", hex: "#f2cdcd" },
        { name: "pink", hex: "#f5c2e7" },
        { name: "mauve", hex: "#cba6f7" },
        { name: "red", hex: "#f38ba8" },
        { name: "maroon", hex: "#eba0ac" },
        { name: "peach", hex: "#fab387" },
        { name: "yellow", hex: "#f9e2af" },
        { name: "green", hex: "#a6e3a1" },
        { name: "teal", hex: "#94e2d5" },
        { name: "sky", hex: "#89dceb" },
        { name: "sapphire", hex: "#74c7ec" },
        { name: "blue", hex: "#89b4fa" },
        { name: "lavender", hex: "#b4befe" },
      ];
      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}`
          : null;
      }
      const randomColor = colors[Math.floor(Math.random() * colors.length)];
      const root = document.documentElement;
      root.style.setProperty("--accent", randomColor.hex);
      root.style.setProperty("--accent-rgb", hexToRgb(randomColor.hex));

      const toggle = document.getElementById("toggle");
      const nameContainer = document.getElementById("nameFieldContainer");
      let overflowTimeout;
      if (toggle.checked) {
        nameContainer.style.maxHeight = "100px";
        nameContainer.style.opacity = "1";
        nameContainer.style.marginTop = "0";
        nameContainer.style.marginBottom = "1rem";
        nameContainer.style.overflow = "visible";
      }
      toggle.addEventListener("change", function () {
        clearTimeout(overflowTimeout);
        if (this.checked) {
          nameContainer.style.maxHeight = "100px";
          nameContainer.style.opacity = "1";
          nameContainer.style.marginTop = "0";
          nameContainer.style.marginBottom = "1rem";
          overflowTimeout = setTimeout(() => {
            nameContainer.style.overflow = "visible";
          }, 500);
          document.getElementById("name").focus();
        } else {
          nameContainer.style.overflow = "hidden";
          nameContainer.style.maxHeight = "0px";
          nameContainer.style.opacity = "0";
          nameContainer.style.marginTop = "0";
          nameContainer.style.marginBottom = "0";
        }
      });

      const canvas = document.getElementById("canvas-bg");
      const ctx = canvas.getContext("2d");
      let width, height;
      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resize);
      resize();
      const symbols = [];
      const symbolChars = ["üí¨", "üí≠", "‚ú®", "üìù", "üí°", "‚úâÔ∏è", "üåü", "üíú"];
      for (let i = 0; i < 60; i++) {
        symbols.push({
          x: Math.random() * width,
          y: Math.random() * height,
          size: 20 + Math.random() * 30,
          speedY: -0.3 - Math.random() * 0.5,
          speedX: (Math.random() - 0.5) * 0.3,
          symbol: symbolChars[Math.floor(Math.random() * symbolChars.length)],
          opacity: 0.1 + Math.random(),
          rotation: Math.random() * Math.PI * 2,
          rotSpeed: (Math.random() - 0.5) * 0.02,
        });
      }
      function animate() {
        ctx.clearRect(0, 0, width, height);
        ctx.font = "28px Arial";
        symbols.forEach((item) => {
          item.y += item.speedY;
          item.x += item.speedX;
          item.rotation += item.rotSpeed;
          if (item.y < -50) {
            item.y = height + 50;
            item.x = Math.random() * width;
          }
          if (item.x < -50) item.x = width + 50;
          if (item.x > width + 50) item.x = -50;
          ctx.save();
          ctx.translate(item.x, item.y);
          ctx.rotate(item.rotation);
          ctx.globalAlpha = item.opacity;
          ctx.fillStyle = randomColor.hex;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(item.symbol, 0, 0);
          ctx.restore();
        });
        requestAnimationFrame(animate);
      }
      animate();

      document
        .getElementById("criticismForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const message = document.getElementById("message").value;
          const isNotAnonymous = document.getElementById("toggle").checked;
          const name = isNotAnonymous
            ? document.getElementById("name").value
            : "Anonymous";
          const statusMsg = document.getElementById("statusMessage");
          const btn = document.getElementById("submitBtn");
          const btnTextEl = btn.querySelector('[data-i18n="submitBtn"]');
          if (!message.trim()) return;
          btn.disabled = true;
          btnTextEl.textContent = translations[currentLang].sending;
          btn.style.opacity = "0.7";
          try {
            const response = await fetch(
              "https://psdk-criticism.psdkiajhn.workers.dev",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  text: `üì© **New Criticism/Feedback**\n\nüë§ **From:** ${name}\nüìù **Message:**\n${message}\n\nüé® **Theme Color:** ${randomColor.name}\nüåê **Language:** ${currentLang === "fa" ? "Persian" : "English"}`,
                  turnstileToken: turnstileToken,
                }),
              },
            );
            const data = await response.json();
            if (response.ok) {
              statusMsg.style.color = "#a6e3a1";
              statusMsg.innerText = translations[currentLang].successMsg;
              document.getElementById("criticismForm").reset();
              nameContainer.style.overflow = "hidden";
              nameContainer.style.maxHeight = "0px";
              nameContainer.style.opacity = "0";
              nameContainer.style.marginTop = "0";
              nameContainer.style.marginBottom = "0";
              setTimeout(() => {
                statusMsg.innerText = "";
              }, 3000);
            } else {
              throw new Error("Server Error");
            }
          } catch (error) {
            console.error(error);
            statusMsg.style.color = "#f38ba8";
            statusMsg.innerText = translations[currentLang].errorMsg;
          } finally {
            btn.disabled = false;
            btnTextEl.textContent = translations[currentLang].submitBtn;
            btn.style.opacity = "1";
          }
        });
    </script>
  </body>
</html>
